'use strict';
var map        = require('map-stream');
var glob       = require('glob');
var path       = require('path');
var changeCase = require('change-case');

let _noPascal = null;

const indexJSCallback = function(file, cb) {
  const fileSpec   = file.path + '/*.js';
  let str        = `// this file is generated by the build process ${new Date() + ''}\n\n`;

  file.path  += '/index.js';

  const exportNames = [];
  const files = glob.sync(fileSpec);

  const doPascal = !_noPascal || !_noPascal.test(fileSpec);

  files.forEach( f => {
    const name = path.parse(f).name;    
    const rname = doPascal ? changeCase.pascalCase(name) : changeCase.camelCase(name);
    exportNames.push(rname);
    str += `import ${rname} from './${name}';\n`;
  });

  str += `\n\nmodule.exports = {\n    ${exportNames.join(',\n    ')} \n};\n\n`;
  file.contents = new Buffer(str);

  cb(null, file);
};

module.exports = function(noPascal) { 
  _noPascal = noPascal || null;
  return map(indexJSCallback); 
};


